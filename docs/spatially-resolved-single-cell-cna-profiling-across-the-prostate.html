<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Spatially resolved single-cell CNA profiling across the prostate | High clonal diversity and spatial genetic admixture in early prostate cancer and surrounding normal tissue</title>
  <meta name="description" content="6 Spatially resolved single-cell CNA profiling across the prostate | High clonal diversity and spatial genetic admixture in early prostate cancer and surrounding normal tissue" />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Spatially resolved single-cell CNA profiling across the prostate | High clonal diversity and spatial genetic admixture in early prostate cancer and surrounding normal tissue" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Spatially resolved single-cell CNA profiling across the prostate | High clonal diversity and spatial genetic admixture in early prostate cancer and surrounding normal tissue" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="comparison-of-sccutseq-and-act.html"/>
<link rel="next" href="random-forest-classification.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="preprocessing.html"><a href="preprocessing.html"><i class="fa fa-check"></i><b>2</b> Preprocessing</a>
<ul>
<li class="chapter" data-level="2.1" data-path="preprocessing.html"><a href="preprocessing.html#demultiplexing-of-fastq-files"><i class="fa fa-check"></i><b>2.1</b> Demultiplexing of fastq files</a></li>
<li class="chapter" data-level="2.2" data-path="preprocessing.html"><a href="preprocessing.html#adapter-trimming"><i class="fa fa-check"></i><b>2.2</b> Adapter trimming</a></li>
<li class="chapter" data-level="2.3" data-path="preprocessing.html"><a href="preprocessing.html#aligning-of-cell-specific-fastq-files"><i class="fa fa-check"></i><b>2.3</b> Aligning of cell specific fastq files</a></li>
<li class="chapter" data-level="2.4" data-path="preprocessing.html"><a href="preprocessing.html#moving-barcodes-and-umis-to-bam-tags"><i class="fa fa-check"></i><b>2.4</b> Moving barcodes and UMIs to bam tags</a></li>
<li class="chapter" data-level="2.5" data-path="preprocessing.html"><a href="preprocessing.html#deduplication"><i class="fa fa-check"></i><b>2.5</b> Deduplication</a></li>
<li class="chapter" data-level="2.6" data-path="preprocessing.html"><a href="preprocessing.html#qc-summary"><i class="fa fa-check"></i><b>2.6</b> QC summary</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="copy-number-calling.html"><a href="copy-number-calling.html"><i class="fa fa-check"></i><b>3</b> Copy number calling</a>
<ul>
<li class="chapter" data-level="3.1" data-path="copy-number-calling.html"><a href="copy-number-calling.html#transform-bam-files"><i class="fa fa-check"></i><b>3.1</b> Transform bam files</a></li>
<li class="chapter" data-level="3.2" data-path="copy-number-calling.html"><a href="copy-number-calling.html#count-reads"><i class="fa fa-check"></i><b>3.2</b> Count reads</a></li>
<li class="chapter" data-level="3.3" data-path="copy-number-calling.html"><a href="copy-number-calling.html#calling-copy-numbers"><i class="fa fa-check"></i><b>3.3</b> Calling copy numbers</a></li>
<li class="chapter" data-level="3.4" data-path="copy-number-calling.html"><a href="copy-number-calling.html#generate-plots"><i class="fa fa-check"></i><b>3.4</b> Generate plots</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="technical-validation-of-sccutseq.html"><a href="technical-validation-of-sccutseq.html"><i class="fa fa-check"></i><b>4</b> Technical validation of scCUTseq</a>
<ul>
<li class="chapter" data-level="4.1" data-path="technical-validation-of-sccutseq.html"><a href="technical-validation-of-sccutseq.html#duplication-rates-of-cutseq-vs-malbac"><i class="fa fa-check"></i><b>4.1</b> Duplication rates of CUTseq vs MALBAC</a></li>
<li class="chapter" data-level="4.2" data-path="technical-validation-of-sccutseq.html"><a href="technical-validation-of-sccutseq.html#pearson-correlation-malbac-scaling"><i class="fa fa-check"></i><b>4.2</b> Pearson correlation MALBAC scaling</a></li>
<li class="chapter" data-level="4.3" data-path="technical-validation-of-sccutseq.html"><a href="technical-validation-of-sccutseq.html#representative-sccutseq-and-smalbac-profiles-of-skbr3-cells"><i class="fa fa-check"></i><b>4.3</b> Representative scCUTseq and sMALBAC profiles of SKBR3 cells</a></li>
<li class="chapter" data-level="4.4" data-path="technical-validation-of-sccutseq.html"><a href="technical-validation-of-sccutseq.html#lorenz-curves-of-sccutseq-and-scaled-malbac"><i class="fa fa-check"></i><b>4.4</b> Lorenz curves of (sc)CUTseq and (scaled) MALBAC</a></li>
<li class="chapter" data-level="4.5" data-path="technical-validation-of-sccutseq.html"><a href="technical-validation-of-sccutseq.html#pearson-correlation-of-fixed-versus-live-skbr3-cells"><i class="fa fa-check"></i><b>4.5</b> Pearson correlation of fixed versus live SKBR3 cells</a></li>
<li class="chapter" data-level="4.6" data-path="technical-validation-of-sccutseq.html"><a href="technical-validation-of-sccutseq.html#genomewide-copy-number-profiles-of-cell-lines"><i class="fa fa-check"></i><b>4.6</b> Genomewide copy number profiles of cell lines</a></li>
<li class="chapter" data-level="4.7" data-path="technical-validation-of-sccutseq.html"><a href="technical-validation-of-sccutseq.html#cross-contamination-experiment-with-dm-and-hs"><i class="fa fa-check"></i><b>4.7</b> Cross-contamination experiment with Dm and Hs</a></li>
<li class="chapter" data-level="4.8" data-path="technical-validation-of-sccutseq.html"><a href="technical-validation-of-sccutseq.html#detection-of-crispr-induced-deletions"><i class="fa fa-check"></i><b>4.8</b> Detection of CRISPR induced deletions</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="comparison-of-sccutseq-and-act.html"><a href="comparison-of-sccutseq-and-act.html"><i class="fa fa-check"></i><b>5</b> Comparison of scCUTseq and ACT</a>
<ul>
<li class="chapter" data-level="5.1" data-path="comparison-of-sccutseq-and-act.html"><a href="comparison-of-sccutseq-and-act.html#calculate-breadth-of-coverage"><i class="fa fa-check"></i><b>5.1</b> Calculate breadth of coverage</a></li>
<li class="chapter" data-level="5.2" data-path="comparison-of-sccutseq-and-act.html"><a href="comparison-of-sccutseq-and-act.html#calculate-overdispersion"><i class="fa fa-check"></i><b>5.2</b> Calculate overdispersion</a></li>
<li class="chapter" data-level="5.3" data-path="comparison-of-sccutseq-and-act.html"><a href="comparison-of-sccutseq-and-act.html#plot-genomewide-heatmaps-of-act-and-sccutseq-copynumber-profiles"><i class="fa fa-check"></i><b>5.3</b> Plot genomewide heatmaps of ACT and scCUTseq copynumber profiles</a></li>
<li class="chapter" data-level="5.4" data-path="comparison-of-sccutseq-and-act.html"><a href="comparison-of-sccutseq-and-act.html#plot-profile-plots-of-example-profiles"><i class="fa fa-check"></i><b>5.4</b> Plot profile plots of example profiles</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html"><i class="fa fa-check"></i><b>6</b> Spatially resolved single-cell CNA profiling across the prostate</a>
<ul>
<li class="chapter" data-level="6.1" data-path="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#spatial-pathologist-annotation"><i class="fa fa-check"></i><b>6.1</b> Spatial pathologist annotation</a></li>
<li class="chapter" data-level="6.2" data-path="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#spatial-distribution-of-rnaseq-clusters-scnas-and-mutations-in-prostate"><i class="fa fa-check"></i><b>6.2</b> Spatial distribution of RNAseq clusters, SCNAs and mutations in prostate</a></li>
<li class="chapter" data-level="6.3" data-path="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cell-type-distribution"><i class="fa fa-check"></i><b>6.3</b> Cell type distribution</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="random-forest-classification.html"><a href="random-forest-classification.html"><i class="fa fa-check"></i><b>7</b> Random forest classification</a>
<ul>
<li class="chapter" data-level="7.1" data-path="random-forest-classification.html"><a href="random-forest-classification.html#loading-in-data"><i class="fa fa-check"></i><b>7.1</b> Loading in data</a></li>
<li class="chapter" data-level="7.2" data-path="random-forest-classification.html"><a href="random-forest-classification.html#obtain-training-set-and-validation-set"><i class="fa fa-check"></i><b>7.2</b> Obtain training set and validation set</a></li>
<li class="chapter" data-level="7.3" data-path="random-forest-classification.html"><a href="random-forest-classification.html#training-the-model"><i class="fa fa-check"></i><b>7.3</b> Training the model</a></li>
<li class="chapter" data-level="7.4" data-path="random-forest-classification.html"><a href="random-forest-classification.html#validating-the-model"><i class="fa fa-check"></i><b>7.4</b> Validating the model</a></li>
<li class="chapter" data-level="7.5" data-path="random-forest-classification.html"><a href="random-forest-classification.html#plotting-number-of-cells-that-pass-qc"><i class="fa fa-check"></i><b>7.5</b> Plotting number of cells that pass QC</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="copy-number-profiles-of-brain-neurons-and-skeletal-muscle-cells.html"><a href="copy-number-profiles-of-brain-neurons-and-skeletal-muscle-cells.html"><i class="fa fa-check"></i><b>8</b> Copy number profiles of brain neurons and skeletal muscle cells</a>
<ul>
<li class="chapter" data-level="8.1" data-path="copy-number-profiles-of-brain-neurons-and-skeletal-muscle-cells.html"><a href="copy-number-profiles-of-brain-neurons-and-skeletal-muscle-cells.html#plot-genomewide-heatmaps"><i class="fa fa-check"></i><b>8.1</b> Plot genomewide heatmaps</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="copy-number-profiles-of-other-prostate-cancer-patients.html"><a href="copy-number-profiles-of-other-prostate-cancer-patients.html"><i class="fa fa-check"></i><b>9</b> Copy number profiles of other prostate cancer patients</a>
<ul>
<li class="chapter" data-level="9.1" data-path="copy-number-profiles-of-other-prostate-cancer-patients.html"><a href="copy-number-profiles-of-other-prostate-cancer-patients.html#plot-genomewide-heatmap"><i class="fa fa-check"></i><b>9.1</b> Plot genomewide heatmap</a></li>
<li class="chapter" data-level="9.2" data-path="copy-number-profiles-of-other-prostate-cancer-patients.html"><a href="copy-number-profiles-of-other-prostate-cancer-patients.html#plot-cell-type-distribution"><i class="fa fa-check"></i><b>9.2</b> Plot cell type distribution</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="nebnext-versus-sccutseq.html"><a href="nebnext-versus-sccutseq.html"><i class="fa fa-check"></i><b>10</b> NEBNext versus scCUTseq</a>
<ul>
<li class="chapter" data-level="10.1" data-path="nebnext-versus-sccutseq.html"><a href="nebnext-versus-sccutseq.html#validating-detected-deletions-using-bulk-nebnext-sequencing"><i class="fa fa-check"></i><b>10.1</b> Validating detected deletions using bulk NEBNext sequencing</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="whole-genome-sequencing-of-blood.html"><a href="whole-genome-sequencing-of-blood.html"><i class="fa fa-check"></i><b>11</b> Whole-Genome Sequencing of blood</a>
<ul>
<li class="chapter" data-level="11.1" data-path="whole-genome-sequencing-of-blood.html"><a href="whole-genome-sequencing-of-blood.html#plotting-wgs-data-for-p3-and-p6-blood"><i class="fa fa-check"></i><b>11.1</b> Plotting WGS data for P3 and P6 blood</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="clonal-analysis-pseudo-diploid-cells.html"><a href="clonal-analysis-pseudo-diploid-cells.html"><i class="fa fa-check"></i><b>12</b> Clonal analysis pseudo-diploid cells</a>
<ul>
<li class="chapter" data-level="12.1" data-path="clonal-analysis-pseudo-diploid-cells.html"><a href="clonal-analysis-pseudo-diploid-cells.html#running-medicc2"><i class="fa fa-check"></i><b>12.1</b> Running MEDICC2</a></li>
<li class="chapter" data-level="12.2" data-path="clonal-analysis-pseudo-diploid-cells.html"><a href="clonal-analysis-pseudo-diploid-cells.html#plot-medicc2-results"><i class="fa fa-check"></i><b>12.2</b> Plot MEDICC2 results</a></li>
<li class="chapter" data-level="12.3" data-path="clonal-analysis-pseudo-diploid-cells.html"><a href="clonal-analysis-pseudo-diploid-cells.html#identify-tumour-subclones"><i class="fa fa-check"></i><b>12.3</b> Identify tumour subclones</a></li>
<li class="chapter" data-level="12.4" data-path="clonal-analysis-pseudo-diploid-cells.html"><a href="clonal-analysis-pseudo-diploid-cells.html#calculate-scnas-per-subclones"><i class="fa fa-check"></i><b>12.4</b> Calculate SCNAs per subclones</a></li>
<li class="chapter" data-level="12.5" data-path="clonal-analysis-pseudo-diploid-cells.html"><a href="clonal-analysis-pseudo-diploid-cells.html#calculate-entropy-per-subclone"><i class="fa fa-check"></i><b>12.5</b> Calculate entropy per subclone</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="phylogenetic-analysis-of-breast-cancer.html"><a href="phylogenetic-analysis-of-breast-cancer.html"><i class="fa fa-check"></i><b>13</b> Phylogenetic analysis of breast cancer</a>
<ul>
<li class="chapter" data-level="13.1" data-path="phylogenetic-analysis-of-breast-cancer.html"><a href="phylogenetic-analysis-of-breast-cancer.html#performing-phylogenetic-analysis"><i class="fa fa-check"></i><b>13.1</b> Performing phylogenetic analysis</a></li>
<li class="chapter" data-level="13.2" data-path="phylogenetic-analysis-of-breast-cancer.html"><a href="phylogenetic-analysis-of-breast-cancer.html#plotting-phylogenetic-tree-and-heatmap"><i class="fa fa-check"></i><b>13.2</b> Plotting phylogenetic tree and heatmap</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="subclonal-distribution-in-prostate.html"><a href="subclonal-distribution-in-prostate.html"><i class="fa fa-check"></i><b>14</b> Subclonal distribution in prostate</a>
<ul>
<li class="chapter" data-level="14.1" data-path="subclonal-distribution-in-prostate.html"><a href="subclonal-distribution-in-prostate.html#plotting-spatial-subclonal-distribution"><i class="fa fa-check"></i><b>14.1</b> Plotting spatial subclonal distribution</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="individual-subclone-distribution-in-prostate.html"><a href="individual-subclone-distribution-in-prostate.html"><i class="fa fa-check"></i><b>15</b> Individual subclone distribution in prostate</a>
<ul>
<li class="chapter" data-level="15.1" data-path="individual-subclone-distribution-in-prostate.html"><a href="individual-subclone-distribution-in-prostate.html#plotting-individual-subclone-distribution"><i class="fa fa-check"></i><b>15.1</b> Plotting individual subclone distribution</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="monster-cells.html"><a href="monster-cells.html"><i class="fa fa-check"></i><b>16</b> Monster cells</a>
<ul>
<li class="chapter" data-level="16.1" data-path="monster-cells.html"><a href="monster-cells.html#clustering-copynumber-profiles"><i class="fa fa-check"></i><b>16.1</b> Clustering copynumber profiles</a></li>
<li class="chapter" data-level="16.2" data-path="monster-cells.html"><a href="monster-cells.html#plotting-genomewide-heatmaps"><i class="fa fa-check"></i><b>16.2</b> Plotting genomewide heatmaps</a></li>
<li class="chapter" data-level="16.3" data-path="monster-cells.html"><a href="monster-cells.html#plot-distribution"><i class="fa fa-check"></i><b>16.3</b> Plot distribution</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="validation-of-pseudodiploid-deletions.html"><a href="validation-of-pseudodiploid-deletions.html"><i class="fa fa-check"></i><b>17</b> Validation of pseudodiploid deletions</a></li>
<li class="chapter" data-level="18" data-path="trrfer-subclone-analysis.html"><a href="trrfer-subclone-analysis.html"><i class="fa fa-check"></i><b>18</b> TRR/FER subclone analysis</a>
<ul>
<li class="chapter" data-level="18.1" data-path="trrfer-subclone-analysis.html"><a href="trrfer-subclone-analysis.html#plotting-deleted-genes-from-trrfer-subclones"><i class="fa fa-check"></i><b>18.1</b> Plotting deleted genes from TRR/FER subclones</a></li>
<li class="chapter" data-level="18.2" data-path="trrfer-subclone-analysis.html"><a href="trrfer-subclone-analysis.html#co-deletions-of-tsgs"><i class="fa fa-check"></i><b>18.2</b> Co-deletions of TSGs</a></li>
<li class="chapter" data-level="18.3" data-path="trrfer-subclone-analysis.html"><a href="trrfer-subclone-analysis.html#tcga-deletion-analysis"><i class="fa fa-check"></i><b>18.3</b> TCGA deletion analysis</a></li>
<li class="chapter" data-level="18.4" data-path="trrfer-subclone-analysis.html"><a href="trrfer-subclone-analysis.html#targeted-sequencing-mutations"><i class="fa fa-check"></i><b>18.4</b> Targeted sequencing mutations</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="cosmic-deletions-and-targeted-panel-mutations.html"><a href="cosmic-deletions-and-targeted-panel-mutations.html"><i class="fa fa-check"></i><b>19</b> COSMIC deletions and targeted panel mutations</a>
<ul>
<li class="chapter" data-level="19.1" data-path="cosmic-deletions-and-targeted-panel-mutations.html"><a href="cosmic-deletions-and-targeted-panel-mutations.html#trrfer-specific-subclones"><i class="fa fa-check"></i><b>19.1</b> TRR/FER specific subclones</a></li>
<li class="chapter" data-level="19.2" data-path="cosmic-deletions-and-targeted-panel-mutations.html"><a href="cosmic-deletions-and-targeted-panel-mutations.html#variant-allele-frequency-snvs"><i class="fa fa-check"></i><b>19.2</b> Variant allele frequency SNVs</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="session-info.html"><a href="session-info.html"><i class="fa fa-check"></i><b>20</b> Session info</a>
<ul>
<li class="chapter" data-level="20.1" data-path="session-info.html"><a href="session-info.html#dockerfile"><i class="fa fa-check"></i><b>20.1</b> Dockerfile</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">High clonal diversity and spatial genetic admixture in early prostate cancer and surrounding normal tissue</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="spatially-resolved-single-cell-cna-profiling-across-the-prostate" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">6</span> Spatially resolved single-cell CNA profiling across the prostate<a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#spatially-resolved-single-cell-cna-profiling-across-the-prostate" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This section produces all the figures used for Figure 1.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Source setup file</span></span>
<span id="cb38-2"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;./functions/setup.R&quot;</span>)</span></code></pre></div>
<div id="spatial-pathologist-annotation" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Spatial pathologist annotation<a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#spatial-pathologist-annotation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Load in pathologist annotation data</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb39-1" aria-hidden="true" tabindex="-1"></a>p3_annot <span class="ot">=</span> <span class="fu">fread</span>(<span class="st">&quot;./annotation/P3.tsv&quot;</span>, <span class="at">header =</span> <span class="cn">FALSE</span>, <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;library&quot;</span>, <span class="st">&quot;section&quot;</span>, <span class="st">&quot;pathology_annotation&quot;</span>))</span>
<span id="cb39-2"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb39-2" aria-hidden="true" tabindex="-1"></a>p6_annot <span class="ot">=</span> <span class="fu">fread</span>(<span class="st">&quot;./annotation/P6.tsv&quot;</span>, <span class="at">header =</span> <span class="cn">FALSE</span>, <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;library&quot;</span>, <span class="st">&quot;section&quot;</span>, <span class="st">&quot;pathology_annotation&quot;</span>))</span></code></pre></div>
<p>Plot the annotation data in the schematic of the prostate of both patients.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract x and y coordinates</span></span>
<span id="cb40-2"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb40-2" aria-hidden="true" tabindex="-1"></a>p3_annot[, x <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">&quot;L|C.&quot;</span>, <span class="st">&quot;&quot;</span>, section))]</span>
<span id="cb40-3"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb40-3" aria-hidden="true" tabindex="-1"></a>p3_annot[, y <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">&quot;L.|C&quot;</span>, <span class="st">&quot;&quot;</span>, section))]</span>
<span id="cb40-4"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb40-5" aria-hidden="true" tabindex="-1"></a>p6_annot[, x <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">&quot;L|C.&quot;</span>, <span class="st">&quot;&quot;</span>, section))]</span>
<span id="cb40-6"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb40-6" aria-hidden="true" tabindex="-1"></a>p6_annot[, y <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">&quot;L.|C&quot;</span>, <span class="st">&quot;&quot;</span>, section))]</span>
<span id="cb40-7"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb40-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-8"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb40-9"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(p3_annot, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> pathology_annotation)) <span class="sc">+</span></span>
<span id="cb40-10"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb40-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb40-11"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb40-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">seq</span>(<span class="at">from =</span> .<span class="dv">5</span>, <span class="at">to =</span> <span class="fu">max</span>(p3_annot<span class="sc">$</span>y), <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb40-12"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb40-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">seq</span>(<span class="at">from =</span> .<span class="dv">5</span>, <span class="at">to =</span> <span class="fu">max</span>(p3_annot<span class="sc">$</span>x), <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb40-13"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb40-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_npg</span>() <span class="sc">+</span></span>
<span id="cb40-14"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb40-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;P3 Pathology annotation&quot;</span>) <span class="sc">+</span></span>
<span id="cb40-15"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb40-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_reverse</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">max</span>(p3_annot<span class="sc">$</span>y)), <span class="at">labels =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">max</span>(p3_annot<span class="sc">$</span>y))) <span class="sc">+</span> </span>
<span id="cb40-16"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb40-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_reverse</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">max</span>(p3_annot<span class="sc">$</span>x)), <span class="at">labels =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">max</span>(p3_annot<span class="sc">$</span>x))) <span class="sc">+</span></span>
<span id="cb40-17"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb40-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="_main_files/figure-html/plot%20annotation%20data-1.png" width="672" /></p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(p6_annot, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> pathology_annotation)) <span class="sc">+</span></span>
<span id="cb41-2"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb41-3"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">seq</span>(<span class="at">from =</span> .<span class="dv">5</span>, <span class="at">to =</span> <span class="fu">max</span>(p6_annot<span class="sc">$</span>y), <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb41-4"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">seq</span>(<span class="at">from =</span> .<span class="dv">5</span>, <span class="at">to =</span> <span class="fu">max</span>(p6_annot<span class="sc">$</span>x), <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb41-5"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_npg</span>() <span class="sc">+</span></span>
<span id="cb41-6"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;P6 Pathology annotation&quot;</span>) <span class="sc">+</span></span>
<span id="cb41-7"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_reverse</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">max</span>(p6_annot<span class="sc">$</span>y)), <span class="at">labels =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">max</span>(p6_annot<span class="sc">$</span>y))) <span class="sc">+</span> </span>
<span id="cb41-8"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_reverse</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">max</span>(p6_annot<span class="sc">$</span>x)), <span class="at">labels =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">max</span>(p6_annot<span class="sc">$</span>x))) <span class="sc">+</span></span>
<span id="cb41-9"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb41-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="_main_files/figure-html/plot%20annotation%20data-2.png" width="672" /></p>
</div>
<div id="spatial-distribution-of-rnaseq-clusters-scnas-and-mutations-in-prostate" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> Spatial distribution of RNAseq clusters, SCNAs and mutations in prostate<a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#spatial-distribution-of-rnaseq-clusters-scnas-and-mutations-in-prostate" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Load in RNAseq clusters, copynumber profiles and mutations. In the case of % of cells with SCNAs, we take all the completely diploid cells and take 1 - (fraction of diploid) to get cells with SCNAs.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Patient 3</span></span>
<span id="cb42-2"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb42-2" aria-hidden="true" tabindex="-1"></a>p3_cnv <span class="ot">=</span> <span class="fu">readRDS</span>(<span class="st">&quot;data/P3_cnv.rds&quot;</span>)</span>
<span id="cb42-3"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb42-3" aria-hidden="true" tabindex="-1"></a>p3_rnaseq <span class="ot">=</span> <span class="fu">fread</span>(<span class="st">&quot;data/P3_RNAseq_clusters.tsv&quot;</span>)</span>
<span id="cb42-4"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb42-4" aria-hidden="true" tabindex="-1"></a>p3_mutations <span class="ot">=</span> <span class="fu">fread</span>(<span class="st">&quot;data/P3_nMuts.tsv&quot;</span>)</span>
<span id="cb42-5"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Patient 6</span></span>
<span id="cb42-7"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb42-7" aria-hidden="true" tabindex="-1"></a>p6_cnv <span class="ot">=</span> <span class="fu">readRDS</span>(<span class="st">&quot;data/P6_cnv.rds&quot;</span>)</span>
<span id="cb42-8"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb42-8" aria-hidden="true" tabindex="-1"></a>p6_rnaseq <span class="ot">=</span> <span class="fu">fread</span>(<span class="st">&quot;data/P6_RNAseq_clusters.tsv&quot;</span>)</span>
<span id="cb42-9"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb42-9" aria-hidden="true" tabindex="-1"></a>p6_mutations <span class="ot">=</span> <span class="fu">fread</span>(<span class="st">&quot;data/P6_nMuts.tsv&quot;</span>)</span></code></pre></div>
<p>Classifiy copynumber profiles into the three cell groups based on the percentage of the genome that is altered and plot the percentages.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb43-1" aria-hidden="true" tabindex="-1"></a>profiles <span class="ot">=</span> p3_cnv<span class="sc">$</span>copynumber[, p3_cnv<span class="sc">$</span>stats[classifier_prediction <span class="sc">==</span> <span class="st">&quot;good&quot;</span>, sample], with <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb43-2"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb43-2" aria-hidden="true" tabindex="-1"></a>bins <span class="ot">=</span> p3_cnv<span class="sc">$</span>bins</span>
<span id="cb43-3"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove all fully diploid cells</span></span>
<span id="cb43-5"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb43-5" aria-hidden="true" tabindex="-1"></a>diploid_vector <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">2</span>, <span class="fu">sum</span>(bins<span class="sc">$</span>chr <span class="sc">!=</span> <span class="st">&quot;X&quot;</span>)), <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">sum</span>(bins<span class="sc">$</span>chr <span class="sc">==</span> <span class="st">&quot;X&quot;</span>)))</span>
<span id="cb43-6"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb43-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-7"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep</span></span>
<span id="cb43-8"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb43-8" aria-hidden="true" tabindex="-1"></a>diploid_check <span class="ot">=</span> <span class="fu">sapply</span>(<span class="fu">colnames</span>(profiles), <span class="cf">function</span>(cell) {</span>
<span id="cb43-9"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb43-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(profiles[[cell]] <span class="sc">!=</span> diploid_vector)</span>
<span id="cb43-10"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb43-10" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb43-11"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb43-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-12"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb43-12" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">=</span> <span class="fu">data.table</span>(<span class="at">sample =</span> <span class="fu">names</span>(diploid_check), <span class="at">num_altered =</span> diploid_check)</span>
<span id="cb43-13"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb43-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-14"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb43-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Divide based on number of alterations</span></span>
<span id="cb43-15"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb43-15" aria-hidden="true" tabindex="-1"></a>diploid_p3 <span class="ot">=</span> profiles[, dt[num_altered <span class="sc">==</span> <span class="dv">0</span>, sample], with <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb43-16"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb43-16" aria-hidden="true" tabindex="-1"></a>pseudodiploid_p3 <span class="ot">=</span> profiles[, dt[num_altered <span class="sc">!=</span> <span class="dv">0</span> <span class="sc">&amp;</span> num_altered <span class="sc">&lt;=</span> .<span class="dv">25</span> <span class="sc">*</span> <span class="fu">nrow</span>(bins), sample], with <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb43-17"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb43-17" aria-hidden="true" tabindex="-1"></a>monster_p3 <span class="ot">=</span> profiles[, dt[num_altered <span class="sc">!=</span> <span class="dv">0</span> <span class="sc">&amp;</span> num_altered <span class="sc">&gt;</span> .<span class="dv">25</span> <span class="sc">*</span> <span class="fu">nrow</span>(bins), sample], with <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb43-18"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb43-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-19"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb43-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Make into DT for plotting</span></span>
<span id="cb43-20"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb43-20" aria-hidden="true" tabindex="-1"></a>overall_p3 <span class="ot">=</span> <span class="fu">data.table</span>(<span class="at">cell_type =</span> <span class="fu">c</span>(<span class="st">&quot;diploid&quot;</span>, <span class="st">&quot;pseudodiploid&quot;</span>, <span class="st">&quot;monster&quot;</span>),</span>
<span id="cb43-21"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb43-21" aria-hidden="true" tabindex="-1"></a>                        <span class="at">number =</span> <span class="fu">c</span>(<span class="fu">ncol</span>(diploid_p3),</span>
<span id="cb43-22"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb43-22" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">ncol</span>(pseudodiploid_p3),</span>
<span id="cb43-23"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb43-23" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">ncol</span>(monster_p3)),</span>
<span id="cb43-24"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb43-24" aria-hidden="true" tabindex="-1"></a>                        <span class="at">patient =</span> <span class="st">&quot;P3&quot;</span>)</span>
<span id="cb43-25"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb43-25" aria-hidden="true" tabindex="-1"></a>overall_p3[, percent <span class="sc">:</span><span class="er">=</span> number <span class="sc">/</span> <span class="fu">sum</span>(number) <span class="sc">*</span> <span class="dv">100</span>]</span></code></pre></div>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb44-1" aria-hidden="true" tabindex="-1"></a>profiles <span class="ot">=</span> p6_cnv<span class="sc">$</span>copynumber[, p6_cnv<span class="sc">$</span>stats[classifier_prediction <span class="sc">==</span> <span class="st">&quot;good&quot;</span>, sample], with <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb44-2"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb44-2" aria-hidden="true" tabindex="-1"></a>bins <span class="ot">=</span> p6_cnv<span class="sc">$</span>bins</span>
<span id="cb44-3"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove all fully diploid cells</span></span>
<span id="cb44-5"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb44-5" aria-hidden="true" tabindex="-1"></a>diploid_vector <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">2</span>, <span class="fu">sum</span>(bins<span class="sc">$</span>chr <span class="sc">!=</span> <span class="st">&quot;X&quot;</span>)), <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">sum</span>(bins<span class="sc">$</span>chr <span class="sc">==</span> <span class="st">&quot;X&quot;</span>)))</span>
<span id="cb44-6"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep</span></span>
<span id="cb44-8"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb44-8" aria-hidden="true" tabindex="-1"></a>diploid_check <span class="ot">=</span> <span class="fu">sapply</span>(<span class="fu">colnames</span>(profiles), <span class="cf">function</span>(cell) {</span>
<span id="cb44-9"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb44-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(profiles[[cell]] <span class="sc">!=</span> diploid_vector)</span>
<span id="cb44-10"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb44-10" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb44-11"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb44-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-12"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb44-12" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">=</span> <span class="fu">data.table</span>(<span class="at">sample =</span> <span class="fu">names</span>(diploid_check), <span class="at">num_altered =</span> diploid_check)</span>
<span id="cb44-13"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb44-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-14"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb44-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Divide based on number of alterations</span></span>
<span id="cb44-15"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb44-15" aria-hidden="true" tabindex="-1"></a>diploid_p6 <span class="ot">=</span> profiles[, dt[num_altered <span class="sc">==</span> <span class="dv">0</span>, sample], with <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb44-16"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb44-16" aria-hidden="true" tabindex="-1"></a>pseudodiploid_p6 <span class="ot">=</span> profiles[, dt[num_altered <span class="sc">!=</span> <span class="dv">0</span> <span class="sc">&amp;</span> num_altered <span class="sc">&lt;=</span> .<span class="dv">25</span> <span class="sc">*</span> <span class="fu">nrow</span>(bins), sample], with <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb44-17"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb44-17" aria-hidden="true" tabindex="-1"></a>monster_p6 <span class="ot">=</span> profiles[, dt[num_altered <span class="sc">!=</span> <span class="dv">0</span> <span class="sc">&amp;</span> num_altered <span class="sc">&gt;</span> .<span class="dv">25</span> <span class="sc">*</span> <span class="fu">nrow</span>(bins), sample], with <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb44-18"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb44-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-19"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb44-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Make into DT for plotting</span></span>
<span id="cb44-20"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb44-20" aria-hidden="true" tabindex="-1"></a>overall_p6 <span class="ot">=</span> <span class="fu">data.table</span>(<span class="at">cell_type =</span> <span class="fu">c</span>(<span class="st">&quot;diploid&quot;</span>, <span class="st">&quot;pseudodiploid&quot;</span>, <span class="st">&quot;monster&quot;</span>),</span>
<span id="cb44-21"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb44-21" aria-hidden="true" tabindex="-1"></a>                        <span class="at">number =</span> <span class="fu">c</span>(<span class="fu">ncol</span>(diploid_p6),</span>
<span id="cb44-22"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb44-22" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">ncol</span>(pseudodiploid_p6),</span>
<span id="cb44-23"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb44-23" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">ncol</span>(monster_p6)),</span>
<span id="cb44-24"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb44-24" aria-hidden="true" tabindex="-1"></a>                        <span class="at">patient =</span> <span class="st">&quot;P6&quot;</span>)</span>
<span id="cb44-25"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb44-25" aria-hidden="true" tabindex="-1"></a>overall_p6[, percent <span class="sc">:</span><span class="er">=</span> number <span class="sc">/</span> <span class="fu">sum</span>(number) <span class="sc">*</span> <span class="dv">100</span>]</span></code></pre></div>
<p>Prepare the data for plotting. RNAseq and mutations are ready for plotting (just add coordinates) but we still need to extract the percentage of cells that have SCNAs from the copynumber profiles. We use the previously compiled list of diploid cells for this.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make data.table with cell names and type</span></span>
<span id="cb45-2"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co"># P3</span></span>
<span id="cb45-3"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-3" aria-hidden="true" tabindex="-1"></a>dt_p3 <span class="ot">=</span> <span class="fu">data.table</span>(<span class="at">sample =</span> <span class="fu">c</span>(<span class="fu">colnames</span>(diploid_p3), </span>
<span id="cb45-4"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-4" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">colnames</span>(pseudodiploid_p3), </span>
<span id="cb45-5"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-5" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">colnames</span>(monster_p3)),</span>
<span id="cb45-6"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">celltype =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;diploid&quot;</span>, <span class="fu">ncol</span>(diploid_p3)),</span>
<span id="cb45-7"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-7" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">rep</span>(<span class="st">&quot;pseudodiploid&quot;</span>, <span class="fu">ncol</span>(pseudodiploid_p3)),</span>
<span id="cb45-8"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-8" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">rep</span>(<span class="st">&quot;monster&quot;</span>, <span class="fu">ncol</span>(monster_p3))))</span>
<span id="cb45-9"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-9" aria-hidden="true" tabindex="-1"></a>dt_p3[, library <span class="sc">:</span><span class="er">=</span> <span class="fu">gsub</span>(<span class="st">&quot;_.*&quot;</span>, <span class="st">&quot;&quot;</span>, sample)]</span>
<span id="cb45-10"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-11"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="co"># P6</span></span>
<span id="cb45-12"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-12" aria-hidden="true" tabindex="-1"></a>dt_p6 <span class="ot">=</span> <span class="fu">data.table</span>(<span class="at">sample =</span> <span class="fu">c</span>(<span class="fu">colnames</span>(diploid_p6), </span>
<span id="cb45-13"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-13" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">colnames</span>(pseudodiploid_p6), </span>
<span id="cb45-14"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-14" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">colnames</span>(monster_p6)),</span>
<span id="cb45-15"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-15" aria-hidden="true" tabindex="-1"></a>                   <span class="at">celltype =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;diploid&quot;</span>, <span class="fu">ncol</span>(diploid_p6)),</span>
<span id="cb45-16"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-16" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">rep</span>(<span class="st">&quot;pseudodiploid&quot;</span>, <span class="fu">ncol</span>(pseudodiploid_p6)),</span>
<span id="cb45-17"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-17" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">rep</span>(<span class="st">&quot;monster&quot;</span>, <span class="fu">ncol</span>(monster_p6))))</span>
<span id="cb45-18"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-18" aria-hidden="true" tabindex="-1"></a>dt_p6[, library <span class="sc">:</span><span class="er">=</span> <span class="fu">gsub</span>(<span class="st">&quot;_.*&quot;</span>, <span class="st">&quot;&quot;</span>, sample)]</span>
<span id="cb45-19"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-20"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Get counts per section</span></span>
<span id="cb45-21"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-21" aria-hidden="true" tabindex="-1"></a>total_p3 <span class="ot">=</span> dt_p3[, .N, by <span class="ot">=</span> .(library)]</span>
<span id="cb45-22"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-22" aria-hidden="true" tabindex="-1"></a>total_p6 <span class="ot">=</span> dt_p6[, .N, by <span class="ot">=</span> .(library)]</span>
<span id="cb45-23"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-24"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Get diploid counts per section</span></span>
<span id="cb45-25"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-25" aria-hidden="true" tabindex="-1"></a>count_p3 <span class="ot">=</span> dt_p3[celltype <span class="sc">==</span> <span class="st">&quot;diploid&quot;</span>, .N, by <span class="ot">=</span> .(library)]</span>
<span id="cb45-26"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-26" aria-hidden="true" tabindex="-1"></a>count_p6 <span class="ot">=</span> dt_p6[celltype <span class="sc">==</span> <span class="st">&quot;diploid&quot;</span>, .N, by <span class="ot">=</span> .(library)]</span>
<span id="cb45-27"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-28"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge and get fraction of non-diploid (1-diploid)</span></span>
<span id="cb45-29"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-29" aria-hidden="true" tabindex="-1"></a>count_p3 <span class="ot">=</span> <span class="fu">merge</span>(count_p3, total_p3, <span class="at">by =</span> <span class="st">&quot;library&quot;</span>)</span>
<span id="cb45-30"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-30" aria-hidden="true" tabindex="-1"></a>count_p6 <span class="ot">=</span> <span class="fu">merge</span>(count_p6, total_p6, <span class="at">by =</span> <span class="st">&quot;library&quot;</span>)</span>
<span id="cb45-31"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-32"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-32" aria-hidden="true" tabindex="-1"></a>count_p3[, nondiploid_fraction <span class="sc">:</span><span class="er">=</span> <span class="dv">1</span> <span class="sc">-</span> (N.x <span class="sc">/</span> N.y)]</span>
<span id="cb45-33"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-33" aria-hidden="true" tabindex="-1"></a>count_p6[, nondiploid_fraction <span class="sc">:</span><span class="er">=</span> <span class="dv">1</span> <span class="sc">-</span> (N.x <span class="sc">/</span> N.y)]</span>
<span id="cb45-34"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-35"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge with annotation</span></span>
<span id="cb45-36"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-36" aria-hidden="true" tabindex="-1"></a>count_p3 <span class="ot">=</span> <span class="fu">merge</span>(count_p3, p3_annot)</span>
<span id="cb45-37"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-37" aria-hidden="true" tabindex="-1"></a>count_p6 <span class="ot">=</span> <span class="fu">merge</span>(count_p6, p6_annot)</span>
<span id="cb45-38"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-39"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Get coordinates</span></span>
<span id="cb45-40"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-40" aria-hidden="true" tabindex="-1"></a>count_p3[, x <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">&quot;L|C.&quot;</span>, <span class="st">&quot;&quot;</span>, section))]</span>
<span id="cb45-41"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-41" aria-hidden="true" tabindex="-1"></a>count_p3[, y <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">&quot;L.|C&quot;</span>, <span class="st">&quot;&quot;</span>, section))]</span>
<span id="cb45-42"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-43"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-43" aria-hidden="true" tabindex="-1"></a>count_p6[, x <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">&quot;L|C.&quot;</span>, <span class="st">&quot;&quot;</span>, section))]</span>
<span id="cb45-44"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb45-44" aria-hidden="true" tabindex="-1"></a>count_p6[, y <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">&quot;L.|C&quot;</span>, <span class="st">&quot;&quot;</span>, section))]</span></code></pre></div>
<p>Plot all the data for Patient 3</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot RNAseq clusters</span></span>
<span id="cb46-2"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb46-2" aria-hidden="true" tabindex="-1"></a>p3_rnaseq[, x <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">&quot;L|C.&quot;</span>, <span class="st">&quot;&quot;</span>, V1))]</span>
<span id="cb46-3"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb46-3" aria-hidden="true" tabindex="-1"></a>p3_rnaseq[, y <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">&quot;L.|C&quot;</span>, <span class="st">&quot;&quot;</span>, V1))]</span>
<span id="cb46-4"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb46-4" aria-hidden="true" tabindex="-1"></a>p3_rnaseq[, V3 <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(V3, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;2&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;3&quot;</span>))]</span>
<span id="cb46-5"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb46-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-6"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(p3_rnaseq, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> V3)) <span class="sc">+</span></span>
<span id="cb46-7"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb46-8"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb46-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_npg</span>() <span class="sc">+</span></span>
<span id="cb46-9"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb46-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">seq</span>(<span class="at">from =</span> .<span class="dv">5</span>, <span class="at">to =</span> <span class="fu">max</span>(p3_rnaseq<span class="sc">$</span>y), <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb46-10"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb46-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">seq</span>(<span class="at">from =</span> .<span class="dv">5</span>, <span class="at">to =</span> <span class="fu">max</span>(p3_rnaseq<span class="sc">$</span>x), <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb46-11"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb46-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;RNA-seq clusters (P3)&quot;</span>) <span class="sc">+</span></span>
<span id="cb46-12"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb46-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_reverse</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span> ), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">max</span>(p3_rnaseq<span class="sc">$</span>y)), <span class="at">labels =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">max</span>(p3_rnaseq<span class="sc">$</span>y))) <span class="sc">+</span> </span>
<span id="cb46-13"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb46-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_reverse</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span> ), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">max</span>(p3_rnaseq<span class="sc">$</span>x)), <span class="at">labels =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">max</span>(p3_rnaseq<span class="sc">$</span>x))) <span class="sc">+</span></span>
<span id="cb46-14"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb46-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="_main_files/figure-html/plot%20Patient%203-1.png" width="672" /></p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot SCNAs</span></span>
<span id="cb47-2"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(count_p3, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> nondiploid_fraction)) <span class="sc">+</span></span>
<span id="cb47-3"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb47-4"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">name =</span> <span class="st">&quot;Percentage of cells</span><span class="sc">\n</span><span class="st">with SCNAs&quot;</span>, <span class="at">palette =</span> <span class="st">&quot;Reds&quot;</span>, <span class="at">direction =</span> <span class="dv">1</span>, <span class="at">na.value =</span> <span class="st">&quot;grey&quot;</span>, <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>()) <span class="sc">+</span></span>
<span id="cb47-5"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">seq</span>(<span class="at">from =</span> .<span class="dv">5</span>, <span class="at">to =</span> <span class="fu">max</span>(count_p3<span class="sc">$</span>y), <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb47-6"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">seq</span>(<span class="at">from =</span> .<span class="dv">5</span>, <span class="at">to =</span> <span class="fu">max</span>(count_p3<span class="sc">$</span>x), <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb47-7"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb47-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Percentage of cells with SCNAs (P3)&quot;</span>) <span class="sc">+</span></span>
<span id="cb47-8"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb47-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_reverse</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span> ), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">max</span>(count_p3<span class="sc">$</span>y)), <span class="at">labels =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">max</span>(count_p3<span class="sc">$</span>y))) <span class="sc">+</span> </span>
<span id="cb47-9"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb47-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_reverse</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span> ), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">max</span>(count_p3<span class="sc">$</span>x)), <span class="at">labels =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">max</span>(count_p3<span class="sc">$</span>x))) <span class="sc">+</span></span>
<span id="cb47-10"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb47-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="_main_files/figure-html/plot%20Patient%203-2.png" width="672" /></p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot number of mutations</span></span>
<span id="cb48-2"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb48-2" aria-hidden="true" tabindex="-1"></a>p3_mutations[, x <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">&quot;L|C.&quot;</span>, <span class="st">&quot;&quot;</span>, section))]</span>
<span id="cb48-3"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb48-3" aria-hidden="true" tabindex="-1"></a>p3_mutations[, y <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">&quot;L.|C&quot;</span>, <span class="st">&quot;&quot;</span>, section))]</span>
<span id="cb48-4"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(p3_mutations, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> n_muts)) <span class="sc">+</span></span>
<span id="cb48-6"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb48-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb48-7"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">name =</span> <span class="st">&quot;Percentage of cells</span><span class="sc">\n</span><span class="st">with SCNAs&quot;</span>, <span class="at">palette =</span> <span class="st">&quot;Reds&quot;</span>, <span class="at">direction =</span> <span class="dv">1</span>, <span class="at">na.value =</span> <span class="st">&quot;grey&quot;</span>, <span class="at">limit =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb48-8"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">seq</span>(<span class="at">from =</span> .<span class="dv">5</span>, <span class="at">to =</span> <span class="fu">max</span>(p3_mutations<span class="sc">$</span>y), <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb48-9"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb48-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">seq</span>(<span class="at">from =</span> .<span class="dv">5</span>, <span class="at">to =</span> <span class="fu">max</span>(p3_mutations<span class="sc">$</span>x), <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb48-10"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb48-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Number of mutations per section (P3)&quot;</span>) <span class="sc">+</span></span>
<span id="cb48-11"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb48-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_reverse</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span> ), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">max</span>(p3_mutations<span class="sc">$</span>y)), <span class="at">labels =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">max</span>(p3_mutations<span class="sc">$</span>y))) <span class="sc">+</span> </span>
<span id="cb48-12"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb48-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_reverse</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span> ), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">max</span>(p3_mutations<span class="sc">$</span>x)), <span class="at">labels =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">max</span>(p3_mutations<span class="sc">$</span>x))) <span class="sc">+</span></span>
<span id="cb48-13"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb48-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="_main_files/figure-html/plot%20Patient%203-3.png" width="672" /></p>
<p>Plot all the data for Patient 6</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot RNAseq clusters</span></span>
<span id="cb49-2"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb49-2" aria-hidden="true" tabindex="-1"></a>p6_rnaseq[, x <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">&quot;L|C.&quot;</span>, <span class="st">&quot;&quot;</span>, V1))]</span>
<span id="cb49-3"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb49-3" aria-hidden="true" tabindex="-1"></a>p6_rnaseq[, y <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">&quot;L.|C&quot;</span>, <span class="st">&quot;&quot;</span>, V1))]</span>
<span id="cb49-4"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb49-4" aria-hidden="true" tabindex="-1"></a>p6_rnaseq[, V3 <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(V3, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;2&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;3&quot;</span>))]</span>
<span id="cb49-5"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(p6_rnaseq, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> V3)) <span class="sc">+</span></span>
<span id="cb49-7"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb49-8"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_npg</span>() <span class="sc">+</span></span>
<span id="cb49-9"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb49-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">seq</span>(<span class="at">from =</span> .<span class="dv">5</span>, <span class="at">to =</span> <span class="fu">max</span>(p6_rnaseq<span class="sc">$</span>y), <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb49-10"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb49-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">seq</span>(<span class="at">from =</span> .<span class="dv">5</span>, <span class="at">to =</span> <span class="fu">max</span>(p6_rnaseq<span class="sc">$</span>x), <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb49-11"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb49-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;RNA-seq clusters (P6)&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;RNA-seq cluster&quot;</span>) <span class="sc">+</span></span>
<span id="cb49-12"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb49-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_reverse</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span> ), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">max</span>(p6_rnaseq<span class="sc">$</span>y)), <span class="at">labels =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">max</span>(p6_rnaseq<span class="sc">$</span>y))) <span class="sc">+</span> </span>
<span id="cb49-13"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb49-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_reverse</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span> ), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">max</span>(p6_rnaseq<span class="sc">$</span>x)), <span class="at">labels =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">max</span>(p6_rnaseq<span class="sc">$</span>x))) <span class="sc">+</span></span>
<span id="cb49-14"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb49-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="_main_files/figure-html/plot%20patient%206-1.png" width="672" /></p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot SCNAs</span></span>
<span id="cb50-2"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(count_p6, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> nondiploid_fraction)) <span class="sc">+</span></span>
<span id="cb50-3"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb50-4"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">name =</span> <span class="st">&quot;Percentage of cells</span><span class="sc">\n</span><span class="st">with SCNAs&quot;</span>, <span class="at">palette =</span> <span class="st">&quot;Reds&quot;</span>, <span class="at">direction =</span> <span class="dv">1</span>, <span class="at">na.value =</span> <span class="st">&quot;grey&quot;</span>, <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>()) <span class="sc">+</span></span>
<span id="cb50-5"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">seq</span>(<span class="at">from =</span> .<span class="dv">5</span>, <span class="at">to =</span> <span class="fu">max</span>(count_p6<span class="sc">$</span>y), <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb50-6"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">seq</span>(<span class="at">from =</span> .<span class="dv">5</span>, <span class="at">to =</span> <span class="fu">max</span>(count_p6<span class="sc">$</span>x), <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb50-7"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Percentage of cells with SCNAs (P6)&quot;</span>) <span class="sc">+</span></span>
<span id="cb50-8"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb50-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_reverse</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span> ), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">max</span>(count_p6<span class="sc">$</span>y)), <span class="at">labels =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">max</span>(count_p6<span class="sc">$</span>y))) <span class="sc">+</span> </span>
<span id="cb50-9"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb50-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_reverse</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span> ), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">max</span>(count_p6<span class="sc">$</span>x)), <span class="at">labels =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">max</span>(count_p6<span class="sc">$</span>x))) <span class="sc">+</span></span>
<span id="cb50-10"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb50-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="_main_files/figure-html/plot%20patient%206-2.png" width="672" /></p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot number of mutations</span></span>
<span id="cb51-2"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb51-2" aria-hidden="true" tabindex="-1"></a>p6_mutations[, x <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">&quot;L|C.&quot;</span>, <span class="st">&quot;&quot;</span>, section))]</span>
<span id="cb51-3"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb51-3" aria-hidden="true" tabindex="-1"></a>p6_mutations[, y <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">&quot;L.|C&quot;</span>, <span class="st">&quot;&quot;</span>, section))]</span>
<span id="cb51-4"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(p6_mutations, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> n_muts)) <span class="sc">+</span></span>
<span id="cb51-6"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb51-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb51-7"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb51-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">name =</span> <span class="st">&quot;Number of mutations&quot;</span>, <span class="at">palette =</span> <span class="st">&quot;Reds&quot;</span>, <span class="at">direction =</span> <span class="dv">1</span>, <span class="at">na.value =</span> <span class="st">&quot;grey&quot;</span>, <span class="at">limit =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb51-8"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb51-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">seq</span>(<span class="at">from =</span> .<span class="dv">5</span>, <span class="at">to =</span> <span class="fu">max</span>(p6_mutations<span class="sc">$</span>y), <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb51-9"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb51-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">seq</span>(<span class="at">from =</span> .<span class="dv">5</span>, <span class="at">to =</span> <span class="fu">max</span>(p6_mutations<span class="sc">$</span>x), <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb51-10"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb51-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Number of mutations per section (P6)&quot;</span>) <span class="sc">+</span></span>
<span id="cb51-11"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb51-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_reverse</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span> ), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">max</span>(p6_mutations<span class="sc">$</span>y)), <span class="at">labels =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">max</span>(p6_mutations<span class="sc">$</span>y))) <span class="sc">+</span> </span>
<span id="cb51-12"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb51-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_reverse</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span> ), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">max</span>(p6_mutations<span class="sc">$</span>x)), <span class="at">labels =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">max</span>(p6_mutations<span class="sc">$</span>x))) <span class="sc">+</span></span>
<span id="cb51-13"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb51-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="_main_files/figure-html/plot%20patient%206-3.png" width="672" /></p>
</div>
<div id="cell-type-distribution" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> Cell type distribution<a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cell-type-distribution" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We detected three different major groups of cells, namely, Diploid cells, pseudo-diploid cells, and monster cells. Above, we already assigned our cells to the different celltype so we can now use this to plot the percentages.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine patients</span></span>
<span id="cb52-2"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb52-2" aria-hidden="true" tabindex="-1"></a>overall <span class="ot">=</span> <span class="fu">rbind</span>(overall_p3, overall_p6)</span>
<span id="cb52-3"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorder factors</span></span>
<span id="cb52-5"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb52-5" aria-hidden="true" tabindex="-1"></a>overall[, cell_type <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(cell_type, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;diploid&quot;</span>, <span class="st">&quot;pseudodiploid&quot;</span>, <span class="st">&quot;monster&quot;</span>))]</span>
<span id="cb52-6"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb52-8"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(overall, <span class="fu">aes</span>(<span class="at">x =</span> patient, <span class="at">y =</span> percent, <span class="at">fill =</span> cell_type, <span class="at">label =</span> number)) <span class="sc">+</span></span>
<span id="cb52-9"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb52-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb52-10"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb52-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb52-11"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb52-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Percentage of cell type&quot;</span>, <span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;Cell type&quot;</span>) <span class="sc">+</span></span>
<span id="cb52-12"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb52-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(percent, <span class="dv">1</span>), <span class="st">&quot;%</span><span class="sc">\n</span><span class="st">(n = &quot;</span>, number, <span class="st">&quot;)&quot;</span>)),</span>
<span id="cb52-13"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb52-13" aria-hidden="true" tabindex="-1"></a>                   <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> .<span class="dv">5</span>), <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb52-14"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb52-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_npg</span>() <span class="sc">+</span></span>
<span id="cb52-15"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb52-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="_main_files/figure-html/plot%20celltype%20distribution%20for%20both%20patients-1.png" width="672" /></p>
<p>Second, we show representative single-cell profiles for these celltypes.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load in plotProfile function to plot copy number profiles</span></span>
<span id="cb53-2"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;functions/plotProfile.R&quot;</span>)</span>
<span id="cb53-3"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Select random diploid, pseudo-diploid and monster cell for each patient</span></span>
<span id="cb53-5"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb53-5" aria-hidden="true" tabindex="-1"></a>diploid_p3_example <span class="ot">=</span> <span class="fu">colnames</span>(diploid_p3)[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(diploid_p3), <span class="dv">1</span>)]</span>
<span id="cb53-6"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb53-6" aria-hidden="true" tabindex="-1"></a>pseudodiploid_p3_example <span class="ot">=</span> <span class="fu">colnames</span>(pseudodiploid_p3)[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(pseudodiploid_p3), <span class="dv">1</span>)]</span>
<span id="cb53-7"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb53-7" aria-hidden="true" tabindex="-1"></a>monster_p3_example <span class="ot">=</span> <span class="fu">colnames</span>(monster_p3)[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(monster_p3), <span class="dv">1</span>)]</span>
<span id="cb53-8"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb53-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-9"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb53-9" aria-hidden="true" tabindex="-1"></a>diploid_p6_example <span class="ot">=</span> <span class="fu">colnames</span>(diploid_p6)[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(diploid_p6), <span class="dv">1</span>)]</span>
<span id="cb53-10"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb53-10" aria-hidden="true" tabindex="-1"></a>pseudodiploid_p6_example <span class="ot">=</span> <span class="fu">colnames</span>(pseudodiploid_p6)[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(pseudodiploid_p6), <span class="dv">1</span>)]</span>
<span id="cb53-11"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb53-11" aria-hidden="true" tabindex="-1"></a>monster_p6_example <span class="ot">=</span> <span class="fu">colnames</span>(monster_p6)[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(monster_p6), <span class="dv">1</span>)]</span>
<span id="cb53-12"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb53-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-13"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb53-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot representative profiles for diploid, pseudo-diploid and monster cells</span></span>
<span id="cb53-14"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb53-14" aria-hidden="true" tabindex="-1"></a><span class="co"># P3</span></span>
<span id="cb53-15"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb53-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plotProfile</span>(p3_cnv<span class="sc">$</span>copynumber[[diploid_p3_example]], p3_cnv<span class="sc">$</span>counts_gc[[diploid_p3_example]] <span class="sc">*</span> p3_cnv<span class="sc">$</span>ploidies[sample <span class="sc">==</span> diploid_p3_example, ploidy], <span class="at">bins =</span> p3_cnv<span class="sc">$</span>bins)</span></code></pre></div>
<p><img src="_main_files/figure-html/plot%20representative%20single-cell%20profiles-1.png" width="672" /></p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotProfile</span>(p3_cnv<span class="sc">$</span>copynumber[[pseudodiploid_p3_example]], p3_cnv<span class="sc">$</span>counts_gc[[pseudodiploid_p3_example]] <span class="sc">*</span> p3_cnv<span class="sc">$</span>ploidies[sample <span class="sc">==</span> pseudodiploid_p3_example, ploidy], <span class="at">bins =</span> p3_cnv<span class="sc">$</span>bins)</span></code></pre></div>
<p><img src="_main_files/figure-html/plot%20representative%20single-cell%20profiles-2.png" width="672" /></p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotProfile</span>(p3_cnv<span class="sc">$</span>copynumber[[monster_p3_example]], p3_cnv<span class="sc">$</span>counts_gc[[monster_p3_example]] <span class="sc">*</span> p3_cnv<span class="sc">$</span>ploidies[sample <span class="sc">==</span> monster_p3_example, ploidy], <span class="at">bins =</span> p3_cnv<span class="sc">$</span>bins)</span></code></pre></div>
<p><img src="_main_files/figure-html/plot%20representative%20single-cell%20profiles-3.png" width="672" /></p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># P6</span></span>
<span id="cb56-2"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plotProfile</span>(p6_cnv<span class="sc">$</span>copynumber[[diploid_p6_example]], p6_cnv<span class="sc">$</span>counts_gc[[diploid_p6_example]] <span class="sc">*</span> p6_cnv<span class="sc">$</span>ploidies[sample <span class="sc">==</span> diploid_p6_example, ploidy], <span class="at">bins =</span> p6_cnv<span class="sc">$</span>bins)</span></code></pre></div>
<p><img src="_main_files/figure-html/plot%20representative%20single-cell%20profiles-4.png" width="672" /></p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotProfile</span>(p6_cnv<span class="sc">$</span>copynumber[[pseudodiploid_p6_example]], p6_cnv<span class="sc">$</span>counts_gc[[pseudodiploid_p6_example]] <span class="sc">*</span> p6_cnv<span class="sc">$</span>ploidies[sample <span class="sc">==</span> pseudodiploid_p6_example, ploidy], <span class="at">bins =</span> p6_cnv<span class="sc">$</span>bins)</span></code></pre></div>
<p><img src="_main_files/figure-html/plot%20representative%20single-cell%20profiles-5.png" width="672" /></p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotProfile</span>(p6_cnv<span class="sc">$</span>copynumber[[monster_p6_example]], p6_cnv<span class="sc">$</span>counts_gc[[monster_p6_example]] <span class="sc">*</span> p6_cnv<span class="sc">$</span>ploidies[sample <span class="sc">==</span> monster_p6_example, ploidy], <span class="at">bins =</span> p6_cnv<span class="sc">$</span>bins)</span></code></pre></div>
<p><img src="_main_files/figure-html/plot%20representative%20single-cell%20profiles-6.png" width="672" />
Plot distribution of celltypes in the different regions</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get counts</span></span>
<span id="cb59-2"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb59-2" aria-hidden="true" tabindex="-1"></a>counts_p3 <span class="ot">=</span> dt_p3[, .N, by <span class="ot">=</span> .(celltype, library)]</span>
<span id="cb59-3"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb59-3" aria-hidden="true" tabindex="-1"></a>counts_p6 <span class="ot">=</span> dt_p6[, .N, by <span class="ot">=</span> .(celltype, library)]</span>
<span id="cb59-4"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb59-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-5"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge with annotation</span></span>
<span id="cb59-6"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb59-6" aria-hidden="true" tabindex="-1"></a>counts_p3 <span class="ot">=</span> <span class="fu">merge</span>(counts_p3, p3_annot)</span>
<span id="cb59-7"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb59-7" aria-hidden="true" tabindex="-1"></a>counts_p6 <span class="ot">=</span> <span class="fu">merge</span>(counts_p6, p6_annot)</span>
<span id="cb59-8"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb59-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-9"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge with total counts per section (calculated in previous section)</span></span>
<span id="cb59-10"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb59-10" aria-hidden="true" tabindex="-1"></a>counts_p3 <span class="ot">=</span> <span class="fu">merge</span>(counts_p3, total_p3)</span>
<span id="cb59-11"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb59-11" aria-hidden="true" tabindex="-1"></a>counts_p6 <span class="ot">=</span> <span class="fu">merge</span>(counts_p6, total_p6)</span>
<span id="cb59-12"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb59-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-13"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb59-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate fraction</span></span>
<span id="cb59-14"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb59-14" aria-hidden="true" tabindex="-1"></a>counts_p3[, fraction <span class="sc">:</span><span class="er">=</span> N.x <span class="sc">/</span> N.y]</span>
<span id="cb59-15"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb59-15" aria-hidden="true" tabindex="-1"></a>counts_p6[, fraction <span class="sc">:</span><span class="er">=</span> N.x <span class="sc">/</span> N.y]</span>
<span id="cb59-16"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb59-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-17"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb59-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorder factors</span></span>
<span id="cb59-18"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb59-18" aria-hidden="true" tabindex="-1"></a>counts_p3[, celltype <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(celltype, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;diploid&quot;</span>, <span class="st">&quot;pseudodiploid&quot;</span>, <span class="st">&quot;monster&quot;</span>))]</span>
<span id="cb59-19"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb59-19" aria-hidden="true" tabindex="-1"></a>counts_p6[, celltype <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(celltype, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;diploid&quot;</span>, <span class="st">&quot;pseudodiploid&quot;</span>, <span class="st">&quot;monster&quot;</span>))]</span>
<span id="cb59-20"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb59-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-21"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb59-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot P3</span></span>
<span id="cb59-22"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb59-22" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(counts_p3, <span class="fu">aes</span>(<span class="at">x =</span> pathology_annotation, <span class="at">y =</span> fraction, <span class="at">color =</span> pathology_annotation)) <span class="sc">+</span></span>
<span id="cb59-23"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb59-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>celltype) <span class="sc">+</span></span>
<span id="cb59-24"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb59-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outlier.shape =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb59-25"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb59-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> .<span class="dv">25</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb59-26"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb59-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_npg</span>() <span class="sc">+</span></span>
<span id="cb59-27"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb59-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, .<span class="dv">25</span>)) <span class="sc">+</span></span>
<span id="cb59-28"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb59-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Fraction of total cells&quot;</span>, <span class="at">x =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb59-29"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb59-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_compare_means</span>(<span class="at">comparisons =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;Cancer&quot;</span>, <span class="st">&quot;Focal&quot;</span>), </span>
<span id="cb59-30"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb59-30" aria-hidden="true" tabindex="-1"></a>                                        <span class="fu">c</span>(<span class="st">&quot;Focal&quot;</span>, <span class="st">&quot;Normal&quot;</span>), </span>
<span id="cb59-31"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb59-31" aria-hidden="true" tabindex="-1"></a>                                        <span class="fu">c</span>(<span class="st">&quot;Cancer&quot;</span>, <span class="st">&quot;Normal&quot;</span>))) <span class="sc">+</span></span>
<span id="cb59-32"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb59-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/celltype%20distribution-1.png" width="672" /></p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot P6</span></span>
<span id="cb60-2"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(counts_p6, <span class="fu">aes</span>(<span class="at">x =</span> pathology_annotation, <span class="at">y =</span> fraction, <span class="at">color =</span> pathology_annotation)) <span class="sc">+</span></span>
<span id="cb60-3"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>celltype) <span class="sc">+</span></span>
<span id="cb60-4"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outlier.shape =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb60-5"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> .<span class="dv">25</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb60-6"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb60-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_npg</span>() <span class="sc">+</span></span>
<span id="cb60-7"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb60-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, .<span class="dv">25</span>)) <span class="sc">+</span></span>
<span id="cb60-8"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb60-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Fraction of total cells&quot;</span>, <span class="at">x =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb60-9"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb60-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_compare_means</span>(<span class="at">comparisons =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;Cancer&quot;</span>, <span class="st">&quot;Focal&quot;</span>), </span>
<span id="cb60-10"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb60-10" aria-hidden="true" tabindex="-1"></a>                                        <span class="fu">c</span>(<span class="st">&quot;Focal&quot;</span>, <span class="st">&quot;Normal&quot;</span>), </span>
<span id="cb60-11"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb60-11" aria-hidden="true" tabindex="-1"></a>                                        <span class="fu">c</span>(<span class="st">&quot;Cancer&quot;</span>, <span class="st">&quot;Normal&quot;</span>))) <span class="sc">+</span></span>
<span id="cb60-12"><a href="spatially-resolved-single-cell-cna-profiling-across-the-prostate.html#cb60-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/celltype%20distribution-2.png" width="672" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="comparison-of-sccutseq-and-act.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="random-forest-classification.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
